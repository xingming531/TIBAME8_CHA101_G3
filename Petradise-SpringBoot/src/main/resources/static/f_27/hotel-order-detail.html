<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>旅館-訂單明細</title>
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i&amp;display=swap">
    <link rel="stylesheet" href="assets/fonts/fontawesome-all.min.css">
    <link rel="stylesheet" href="assets/css/Navbar-With-Button-icons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css">
    <style>

    </style>
</head>

<body id="page-top">
    <div id="wrapper">
        <nav class="navbar navbar-dark align-items-start sidebar sidebar-dark accordion bg-gradient-primary p-0"
            style="background: #f1ecd1;">
            <div class="container-fluid d-flex flex-column p-0">
                <a class="navbar-brand d-flex justify-content-center align-items-center sidebar-brand m-0" href="#">
                    <div class="sidebar-brand-text mx-3">
                        <img width="59" height="33" src="../hotel/assets17/img/avatars/logo-only.png">
                    </div>
                </a>
                <hr class="sidebar-divider my-0">
                <ul class="navbar-nav">
                    <li class="nav-item dropdown show"><a class="dropdown-toggle nav-link" aria-expanded="true"
                            data-bs-toggle="dropdown" data-bs-auto-close="false" href="#"
                            style="color: #a67c52; padding: 5px 16px; font-weight: bold; font-size: 14px;">帳號管理</a>
                        <div class="dropdown-menu show" data-bs-popper="none"
                            style="background: rgba(255, 255, 255, 0); border-style: none; padding: 0px; margin: 0px; margin-bottom: 5px;">
                            <a class="dropdown-item" href="../owner/OwnerAccount.html"
                                style="padding: 2px 30px; font-size: 13px;">基本資料</a>
                            <div class="dropdown-divider" style="border-color: rgb(255, 255, 255);"></div>
                        </div>
                    </li>
                    <li class="nav-item dropdown show"><a class="dropdown-toggle nav-link" aria-expanded="true"
                            data-bs-toggle="dropdown" data-bs-auto-close="false" href="#"
                            style="color: #a67c52; padding: 5px 16px; font-weight: bold; font-size: 14px;">房間管理</a>
                        <div class="dropdown-menu show" data-bs-popper="none"
                            style="background: rgba(255, 255, 255, 0); border-style: none; padding: 0px; margin: 0px; margin-bottom: 5px;">
                            <a class="dropdown-item" href="../hotel/roomType.html"
                                style="padding: 2px 30px; font-size: 13px;">房型資訊</a><a class="dropdown-item"
                                href="../hotel/room.html" style="padding: 2px 30px; font-size: 13px;">房間資訊</a>
                        </div>
                    </li>
                    <li class="nav-item dropdown show"><a class="dropdown-toggle nav-link" aria-expanded="true"
                            data-bs-toggle="dropdown" data-bs-auto-close="false" href="#"
                            style="color: #a67c52; padding: 5px 16px; font-weight: bold; font-size: 14px;">訂單管理</a>
                        <div class="dropdown-menu show" data-bs-popper="none"
                            style="background: rgba(255, 255, 255, 0); border-style: none; padding: 0px; margin: 0px; margin-bottom: 5px;">
                            <a class="dropdown-item" href="../f_27/hotel-orders.html"
                                style="padding: 2px 30px; font-size: 13px;">訂單管理</a>
                            <div class="dropdown-divider" style="border-color: rgb(255, 255, 255);"></div>
                        </div>
                    </li>
                </ul>
                <div class="text-center d-none d-md-inline">
                    <button class="btn rounded-circle border-0" id="sidebarToggle" type="button"></button>
                </div>
            </div>
        </nav>

        <div class="d-flex flex-column" id="content-wrapper">
            <div id="content">
                <nav class="navbar navbar-light navbar-expand bg-white shadow mb-4 topbar static-top">
                    <div class="container-fluid"><button class="btn btn-link d-md-none rounded-circle me-3"
                            id="sidebarToggleTop" type="button"><i class="fas fa-bars"></i></button>
                        <ul class="navbar-nav flex-nowrap ms-auto">
                            <li class="nav-item dropdown no-arrow">
                                <div class="nav-item dropdown no-arrow"><a class="dropdown-toggle nav-link"
                                        aria-expanded="false" data-bs-toggle="dropdown" href="#" id="owner-name"><span
                                            class="d-none d-lg-inline me-2 text-gray-600 small">Valerie Luna</span></a>
                                    <div class="dropdown-menu shadow dropdown-menu-end animated--grow-in"
                                        style="min-width: 110px;"><a class="dropdown-item" href="#"
                                            onclick="logout()"><i
                                                class="fas fa-sign-out-alt fa-sm fa-fw me-2 text-gray-400"></i>&nbsp;Logout</a>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </nav>

                <div class="container py-4 py-xl-5" style="width: 60%;">
                    <h1 style="font-weight: bold;text-align: center;">訂單明細</h1>
                    <div>訂單編號: <span id="order-id"></span>　　狀態: <span id="order-status"></span></div>
                    <!-- <div>訂單狀態: <span id="order-status"></span></div> -->
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">住客資訊</h5>
                        </div>
                        <div class="card-body">
                            <div class="card-text">客戶名稱<span id="customer-name" style="float: right;"></span></div>
                            <div class="card-text">寵物名稱<span id="pet-name" style="float: right;"></span></div>
                            <div class="card-text">手機<span id="phone" style="float: right;"></span></div>
                            <div class="card-text">Email<span id="email" style="float: right;"></span></div>

                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">住宿資訊</h5>
                        </div>
                        <div class="card-body">
                            <div class="card-text">房型<span id="room-type" style="float: right;"></span></div>
                            <div class="card-text">房間號碼<span id="room-number" style="float: right;"></span></div>
                            <div class="card-text">訂單成立日期<span id="order-date" style="float: right;"></span></div>
                            <div class="card-text">入住日期<span id="check-in-date" style="float: right;"></span></div>
                            <div class="card-text">退房日期<span id="check-out-date" style="float: right;"></span></div>
                            <div class="card-text">特殊需求<span id="special-req" style="float: right;"></span></div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">付款資訊</h5>
                        </div>
                        <div class="card-body">
                            <p class="card-text">
                                <span style="color: black;">付款方式</span>
                                <span id="payment-method" style="float: right;"></span><br>
                                <strong>
                                    <span style="color: black;">總金額TWD</span>
                                    <span id="price" style="float: right;"></span>
                                </strong>
                            </p>
                        </div>
                    </div>
                </div>

                <footer class="bg-white sticky-footer">
                    <div class="container my-auto">
                        <div class="text-center my-auto copyright"><span>Copyright © Brand 2023</span></div>
                    </div>
                </footer>
            </div><a class="border rounded d-inline scroll-to-top" href="#page-top"><i class="fas fa-angle-up"></i></a>
        </div>
        <script src="assets/bootstrap/js/bootstrap.min.js"></script>
        <script src="assets/js/theme.js"></script>

        <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
        <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
        <script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/6.4.8/swiper-bundle.min.js"></script>
        <script src="assets/js/Simple-Slider.js"></script>
        <script src="../assets/js/hotel_owner_login.js"></script>
        <script>
            $(document).ready(function () {
                const ownerName = getHotelOwnerName();
                if (ownerName) {
                    $('#owner-name').text(ownerName);
                }
            });
            // Retrieve the order ID from the URL
            const urlParams = new URLSearchParams(window.location.search);
            const orderId = urlParams.get('id');

            // Make an AJAX request to fetch the order details
            const url = `/room-order/id/${orderId}`;
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    // Update the HTML elements with the order information
                    document.getElementById('order-id').textContent = data.id;
                    document.getElementById('order-status').textContent = getStatusText(data.status);

                    // Fetch additional member details
                    const memberId = data.memId;
                    const memberUrl = `/members/id=${memberId}`;
                    fetch(memberUrl)
                        .then(response => response.json())
                        .then(memberData => {
                            document.getElementById('customer-name').textContent = memberData.name;
                            document.getElementById('phone').textContent = memberData.phone;
                            document.getElementById('email').textContent = memberData.email;
                        })
                        .catch(error => {
                            console.error('Error fetching member details:', error);
                            // Handle error case for member details
                        });

                    // Fetch room type name by room type id
                    const roomTypeId = data.roomTypeId;
                    const roomTypeUrl = `/roomTypes/${roomTypeId}`;
                    fetch(roomTypeUrl)
                        .then(response => response.json())
                        .then(roomTypeData => {
                            document.getElementById('room-type').textContent = roomTypeData.roomTypeName;
                        })
                        .catch(error => {
                            console.error('Error fetching room type name:', error);
                        });

                    // Fetch room name by room id
                    const roomId = data.roomId;
                    const roomUrl = `/rooms/${roomId}`;
                    fetch(roomUrl)
                        .then(response => response.json())
                        .then(roomData => {
                            document.getElementById('room-number').textContent = roomData.roomName;
                        })
                        .catch(error => {
                            console.error('Error fetching room type name:', error);
                        });


                    document.getElementById('pet-name').textContent = data.petName;
                    document.getElementById('order-date').textContent = formatDateTime(data.orderDate);
                    document.getElementById('check-in-date').textContent = new Date(data.checkInDate).toLocaleDateString();
                    document.getElementById('check-out-date').textContent = new Date(data.checkOutDate).toLocaleDateString();
                    document.getElementById('special-req').textContent = data.specialReq;
                    document.getElementById('payment-method').textContent = getMethodText(data.payMethod);

                    // Calculate the total price of stay
                    const checkInDate = new Date(data.checkInDate);
                    const checkOutDate = new Date(data.checkOutDate);
                    const roomPrice = data.price;
                    const nights = Math.ceil((checkOutDate - checkInDate) / (1000 * 60 * 60 * 24)); // Calculate the number of nights
                    const totalPrice = roomPrice * nights;

                    // Update the room type price with additional text
                    const additionalText = ` x ${nights}晚 = ${totalPrice} 元`;
                    document.getElementById('price').textContent = data.price + additionalText;
                })
                .catch(error => {
                    console.error('Error:', error);
                    // Handle error case for room order details
                });

            // Function to format date and time and timezone
            function formatDateTime(dateTime) {
                const options = {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit',
                };

                // Convert the dateTime to GMT+8
                const gmtDateTime = new Date(dateTime);
                gmtDateTime.setUTCHours(gmtDateTime.getUTCHours() + 8);

                return gmtDateTime.toLocaleString(options);
            }

            // Helper function to get the status text
            function getStatusText(status) {
                if (status === "0") {
                    return "即將到來";
                } else if (status === "1") {
                    return "已完成";
                } else if (status === "2") {
                    return "已取消";
                } else {
                    return "";
                }
            }

            // Helper function to get the payment method
            function getMethodText(method) {
                if (method === "0") {
                    return "到店付款";
                } else if (method === "1") {
                    return "信用卡結帳";
                } else {
                    return "";
                }
            }

        </script>
</body>

</html>