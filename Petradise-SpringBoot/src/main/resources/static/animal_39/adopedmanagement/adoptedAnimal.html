<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>動物資訊</title>
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i&amp;display=swap">
    <link rel="stylesheet" href="assets/fonts/fontawesome-all.min.css">
    <link rel="stylesheet" href="assets/css/custom.css">
    <link rel="stylesheet" href="assets/css/Ludens---3-Edit-Dark-mode.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css">
    <link rel="shortcut icon" href="/assets/img/fav_icon.png" type="image/x-icon">
    <!-- jquery  -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
    <!-- datatable  css-->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.css" />
    <!-- datatable js -->
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.js"></script>

</head>

<body id=" page-top">
    <div id="wrapper">
        <nav class="navbar navbar-dark align-items-start sidebar sidebar-dark accordion bg-gradient-primary p-0"
            style="background: #f1ecd1;">
            <div class="container-fluid d-flex flex-column p-0">
                <a class="navbar-brand d-flex justify-content-center align-items-center sidebar-brand m-0" href="#">
                    <div class="sidebar-brand-text mx-3">
                        <img width="59" height="33" src="assets/img/avatars/logo-only.png">
                    </div>
                </a>
                <hr class="sidebar-divider my-0">
                <ul class="navbar-nav">
                    <li class="nav-item dropdown show"><a class="dropdown-toggle nav-link" aria-expanded="true"
                            data-bs-toggle="dropdown" data-bs-auto-close="false" href="#"
                            style="color: #a67c52; padding: 5px 16px; font-weight: bold; font-size: 14px;">收容所帳號管理</a>
                        <div class="dropdown-menu show" data-bs-popper="none"
                            style="background: rgba(255, 255, 255, 0); border-style: none; padding: 0px; margin: 0px; margin-bottom: 5px;">
                            <a class="dropdown-item" href="/animal_39/animalform/updatecorporationaccountedit.html"
                                style="padding: 2px 30px; font-size: 13px;">收容資訊</a>
                            <div class="dropdown-divider" style="border-color: rgb(255, 255, 255);"></div>
                        </div>
                    </li>
                    <li class="nav-item dropdown show"><a class="dropdown-toggle nav-link" aria-expanded="true"
                            data-bs-toggle="dropdown" data-bs-auto-close="false" href="#"
                            style="color: #a67c52; padding: 5px 16px; font-weight: bold; font-size: 14px;">流浪動物資訊</a>
                        <div class="dropdown-menu show" data-bs-popper="none"
                            style="background: rgba(255, 255, 255, 0); border-style: none; padding: 0px; margin: 0px; margin-bottom: 5px;">
                            <a class="dropdown-item" href="/animal_39/adopedmanagement/adoptedAnimal.html"
                                style="padding: 2px 30px; font-size: 13px;">新增動物</a>
                        </div>
                    </li>
                    <li class="nav-item dropdown show"><a class="dropdown-toggle nav-link" aria-expanded="true"
                            data-bs-toggle="dropdown" data-bs-auto-close="false" href="#"
                            style="color: #a67c52; padding: 5px 16px; font-weight: bold; font-size: 14px;">領養管理</a>
                        <div class="dropdown-menu show" data-bs-popper="none"
                            style="background: rgba(255, 255, 255, 0); border-style: none; padding: 0px; margin: 0px; margin-bottom: 5px;">
                            <a class="dropdown-item" href="#" style="padding: 2px 30px; font-size: 13px;"></a><a
                                class="dropdown-item"
                                href="/animal_39/adopedmanagement/adoptedapplicationManagement.html"
                                style="padding: 2px 30px; font-size: 13px;">認養管理</a>
                            <div class="dropdown-divider" style="border-color: rgb(255, 255, 255);"></div>
                        </div>
                    </li>
                    <!-- <li class="nav-item dropdown show"><a class="dropdown-toggle nav-link" aria-expanded="true"
                            data-bs-toggle="dropdown" data-bs-auto-close="false" href="#"
                            style="color: #a67c52;padding: 5px 16px;font-weight: bold;font-size: 14px;">即時聊天管理</a>
                        <div class="dropdown-menu show" data-bs-popper="none"
                            style="background: rgba(255,255,255,0);border-style: none;padding: 0px;margin: 0px;margin-bottom: 5px;">
                            <a class="dropdown-item" href="#" style="padding: 2px 30px;font-size: 13px;">客服列表</a>
                            <div class="dropdown-divider" style="border-color: rgb(255,255,255);"></div>
                        </div> -->
                    <!--      </li> -->
                </ul>
                <div class="text-center d-none d-md-inline">
                    <button class="btn rounded-circle border-0" id="sidebarToggle" type="button"></button>
                </div>
            </div>
        </nav>
        <div class="d-flex flex-column" id="content-wrapper">
            <div id="content">
                <nav class="navbar navbar-light navbar-expand bg-white shadow mb-4 topbar static-top">
                    <div class="container-fluid">
                        <button class="btn btn-link d-md-none rounded-circle me-3" id="sidebarToggleTop" type="button">
                            <i class="fas fa-bars"></i>
                        </button>
                        <ul class="navbar-nav flex-nowrap ms-auto">
                            <li class="nav-item dropdown no-arrow">
                                <div class="nav-item dropdown no-arrow">
                                    <a class="dropdown-toggle nav-link" aria-expanded="false" data-bs-toggle="dropdown"
                                        href="#"><span id="owner-name"
                                            class="d-none d-lg-inline me-2 text-gray-600 small"></span></a>
                                    <div class="dropdown-menu shadow dropdown-menu-end animated--grow-in"
                                        style="min-width: 110px;">
                                        <a class="dropdown-item" href="#" onclick="logout()"><i
                                                class="fas fa-sign-out-alt fa-sm fa-fw me-2 text-gray-400"></i>Logout</a>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </nav>

                <div class="container-fluid">
                    <h3 class="text-dark mb-4">動物資訊</h3>
                    <div class="card shadow">
                        <div class="card-header py-3">
                            <!-- Button -->
                            <button type="button" class="btn btn-primary" id="animalAddButton" data-bs-toggle="modal"
                                data-bs-target="#exampleModal" data-bs-whatever="@mdo">動物新增</button>

                            <div class="controll-content activity-order-controll-content">
                                <table id="all" class="display" style="width: 100%">
                                    <thead>
                                        <tr>
                                            <!--<th>動物編號</th>-->
                                            <th>動物</th>
                                            <th>業主</th>
                                            <th>種類</th>
                                            <th>名字</th>
                                            <th>性別</th>
                                            <th>年齡</th>
                                            <th>狀態</th>
                                            <!-- <th>備註</th> -->
                                            <th>照片</th>
                                            <th>修改</th>
                                       



                                        <!-- <div class="row">
<div class="col-md-6 align-self-center">
<p id="dataTable_info" class="dataTables_info" role="status" aria-live="polite">
Showing 1 to 10 of 27</p>
</div>
<div class="col-md-6">
<nav class="d-lg-flex justify-content-lg-end dataTables_paginate paging_simple_numbers">
<ul class="pagination">
<li class="page-item disabled"><a class="page-link" aria-label="Previous" href="#"><span
            aria-hidden="true">«</span></a></li>
<li class="page-item active"><a class="page-link" href="#">1</a>
</li>
<li class="page-item"><a class="page-link" href="#">2</a></li>
<li class="page-item"><a class="page-link" href="#">3</a></li>
<li class="page-item"><a class="page-link" aria-label="Next" href="#"><span
            aria-hidden="true">»</span></a></li>
</ul>
</nav>
</div>
</div> -->


                                        <!--  </div><a class="border rounded d-inline scroll-to-top" href="#page-top"><i class="fas fa-angle-up"></i></a>
</div>-->


                                        <script src="assets/bootstrap/js/bootstrap.min.js"></script>
                                        <script src="assets/js/theme.js"></script>
                                        <script
                                            src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
                                        <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
                                        <script
                                            src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
                                        <script
                                            src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>
                                        <!-- 引入bootstrap CDN -->
                                        <script
                                            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
                                            integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
                                            crossorigin="anonymous"></script>
                                        <script src="../../assets/js/animal_corporation_login.js"></script>

                                        <!-- 新引入的JS檔案或套件請由此往下放 -->
                                        <script>
                                            $(document).ready(function () {
                                                const ownerName = getAnimalCorporationName();
                                                if (ownerName) {
                                                    $('#owner-name').text(ownerName);
                                                }
                                            });
                                        </script>

                                        <script>
                                            const popoverTriggerList = document.querySelectorAll('[data-bs-toggle="popover"]')
                                            const popoverList = [...popoverTriggerList].map(popoverTriggerEl => new bootstrap.Popover(popoverTriggerEl))
                                        </script>

                                        <script>
                                            const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
                                            const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
                                        </script>

                                        <!-- JS -->
                                        <script
                                            src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
                                            integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
                                            crossorigin="anonymous"></script>
                                        <script
                                            src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.min.js"
                                            integrity="sha384-lpyLfhYuitXl2zRZ5Bn2fqnhNAKOAaM/0Kr9laMspuaMiZfGmfwRNFh8HlMy49eQ"
                                            crossorigin="anonymous"></script>


                                        <script>

                                                (() => {
                                                    const tbody = document.querySelector('#tbody');


                                                    $(document).ready(function () {
                                                        // 监听按钮点击事件
                                                        $('#animalAddButton').click(function () {
                                                            // 执行页面重定向
                                                            window.location.href = '/animal_39/animalform/addanimalfrom.html';
                                                        });
                                                    });


                                                    $(document).ready(function () {
                                                        // 为按钮添加点击事件处理程序
                                                        $('#editbutton').click(function () {
                                                            // 在此处执行页面跳转
                                                            window.location.href = '/animal_39/animalform/updateaniml.html';
                                                        });
                                                    });


                                                    let dataaccount = 0;
                                                    let Animal = [];
                                                    // 先用URL的方式 抓取id
                                                    // var urlParams = new URLSearchParams(window.location.search);
                                                    // var corpId = urlParams.get('id');
                                                    var corpId = getAnimalCorporationId();

                                                    function getAllAnimal() {
                                                        console.log('進入getAllAnimal()')
                                                        fetch("/animals/corpId=" + corpId)
                                                            .then(function (response) {
                                                                // 檢查 API 响應的狀態碼
                                                                if (response.status !== 200) {
                                                                    console.log('發生錯誤，狀態碼：' + response.status);
                                                                    return;
                                                                }

                                                                // 解析 JSON 格式的數據
                                                                response.json().then(function (data) {
                                                                    // 在此處可以處理從 API 獲取的數據
                                                                    Animal = data;
                                                                    console.log('獲取動物資訊：', Animal);


                                                                    for (let i = 0; i < Animal.length; i++) {
                                                                        dataaccount = i;
                                                                        let row = Animal[i];
                                                                        const animalid = row.animalId;
                                                                        const corpid = row.corpId;
                                                                        //const memid = row.memid;
                                                                        const animaltype = row.animalType;
                                                                        const animalname = row.animalName;
                                                                        const animalsex = row.animalSex;
                                                                        const animalage = row.animalAge;
                                                                        const aniamlstatus = row.aniamlStatus;

                                                                        const animalpic = row.animalPic; // 从API响应中获取动物图片数据

                                                                        const reader = new FileReader();

                                                                        const imageTag = animalpic;

                                                                        dataTable.row.add([
                                                                            row.animalId,
                                                                            row.corpId,
                                                                            //row.memId,
                                                                            row.animalType,
                                                                            row.animalName,
                                                                            row.animalSex,
                                                                            row.animalAge,
                                                                            row.aniamlStatus,
                                                                            `<img src='data:image/*;base64,${imageTag}' width="50"  height="50">`,


                                                                            `<button type="button" class="btn btn-primary"
                    data-bs-target="#exampleModal${i}" data-bs-whatever="@mdo" id="editbutton">修改
            </button>`,


                                                                        ]);
                                                                    }
                                                                    dataTable.draw();

                                                                })
                                                            })
                                                    }


                                                    $(document).on("click", "#editbutton", function () {

                                                        var rowIndex = $(this).closest("tr").index();

                                                        // 使用索引获取对应的动物对象和动物ID
                                                        var row = Animal[rowIndex];
                                                        var animalId = row.animalId;

                                                        window.location.href = "/animal_39/animalform/updateaniml.html?id=" + animalId;


                                                    });


                                                    // ============================2.  初始化datatable函式========================

                                                    let dataTable = $('#all').DataTable({
                                                        scrollY: '600px',
                                                        scrollCollapse: true,
                                                        paging: false,
                                                        pageLength: 10,
                                                        info: false,
                                                        destroy: true,
                                                    });


                                                    getAllAnimal();

                                                })();
                                        </script>
</body>

</html>